<p-toast position="top-right"></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="global-overlay" *ngIf="isLoading">
    <!-- Overlay semi-transparent -->
    <div class="overlay"></div>

    <div class="spinner-container" style="position: relative; display: flex; flex-direction: column; align-items: center;">
        <p-progressSpinner class="custom-spinner"
                           [style]="{'width': '80px', 'height': '80px'}"
                           strokeWidth="3.5"
                           animationDuration="0.5s">
        </p-progressSpinner>

        <!-- Pourcentage affiché au centre du spinner -->
        <p style="font-size: 18px; color: white; position: absolute; z-index: 1;">{{ progress | number:'1.0-0' }}%</p>
    </div>
</div>






<form (ngSubmit)="onSubmit(societeForm)" #societeForm="ngForm" class="societe-form">
    <p-card>
        <div class="form-header mb-4">
            <h2 class="text-2xl font-bold text-center text-primary">{{ societe?.nom }}</h2>
        </div>

        <div class="flex justify-content-center mb-4">
            <div class="border-1 border-round p-3">
                <img [src]="societe?.logo" alt="Logo" class="border-round" width="150" />
            </div>
        </div>

        <div class="nav-container mb-4">
            <p-tabView styleClass="custom-tabview">
                <!-- Général Tab -->
                <p-tabPanel header="Général">
                    <div class="grid formgrid p-3">
                        <div class="field col-12 md:col-6">
                            <label for="nom" class="block font-medium mb-2">Nom*</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-building"></i>
                <input id="nom" type="text" [(ngModel)]="societe.nom" name="nom" pInputText class="w-full" placeholder="Enter company name" required />
              </span>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label for="societeMere" class="block font-medium mb-2">Société Mère</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-sitemap"></i>
                <input id="societeMere" type="text" [(ngModel)]="societe.societeMere"  name="societeMere" pInputText class="w-full" placeholder="Enter parent company" />
              </span>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label for="adresse" class="block font-medium mb-2">Adresse*</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-map-marker"></i>
                <input id="adresse" type="text" [(ngModel)]="societe.adresse" name="adresse" pInputText class="w-full" placeholder="Enter address" required />
              </span>
                        </div>
                        <div class="col-6">
                            <div class="field">
                                <label for="secteur" class="font-bold"><i class="pi pi-chart-bar"></i> Secteur</label>
                                <input id="secteur" type="text" [(ngModel)]="societe.secteur" name="secteur" pInputText class="w-full" placeholder="Entrer le secteur" required />
                            </div>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label for="capitalSocial" class="block font-medium mb-2">Capital Social*</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-euro"></i>
                <p-inputNumber id="capitalSocial" [(ngModel)]="societe.capitalSocial" name="capitalSocial" mode="currency" currency="EUR" locale="fr-FR" class="w-full"></p-inputNumber>
              </span>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label for="rcs" class="block font-medium mb-2">RCS*</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-id-card"></i>
                <input id="rcs" type="text" [(ngModel)]="societe.rcs"  name="rcs" pInputText class="w-full" placeholder="Enter RCS number" required />
              </span>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label for="villeRcs" class="block font-medium mb-2">Ville RCS*</label>
                            <span class="p-input-icon-left w-full">
                <i class="pi pi-home"></i>
                <input id="villeRcs" type="text" [(ngModel)]="societe.villeRcs"  name="villeRcs" pInputText class="w-full" placeholder="Enter RCS city" required />
              </span>
                        </div>

                        <div class="field col-12">
                            <label for="logo" class="block font-medium mb-2">Logo</label>
                            <div class="flex align-items-center p-3 border-1 border-dashed border-primary-200 border-round">
                                <img [src]="societe.logo" alt="Logo" *ngIf="societe.logo" class="mr-3 border-round" width="100" />
                                <p-fileUpload id="logo" name="logo" accept="image/*" (onSelect)="onLogoChange($event)"
                                              [showUploadButton]="false" [showCancelButton]="false" chooseLabel="Choisir un Logo">
                                </p-fileUpload>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Organigramme Tab -->
                <p-tabPanel header="Organigramme">
                    <div class="p-3">
                        <div class="field">
                            <label class="block font-medium mb-3">Organigrammes</label>

                            <!-- Grid Container -->
                            <div class="grid">
                                <div *ngFor="let organigramme of societe.organigramme; let i = index"
                                     class="col-12 md:col-4 lg:col-4 mb-3">

                                    <!-- Using p-card for consistent styling -->
                                    <p-card styleClass="h-full">
                                        <div class="flex flex-column align-items-center">
                                            <!-- Image Container with fixed dimensions -->
                                            <div class="image-container mb-3" style="width: 100%; height: 200px; overflow: hidden;">
                                                <img [src]="organigramme"
                                                     alt="Organigramme {{ i + 1 }}"
                                                     class="cursor-pointer"
                                                     (click)="openImageInNewTab(organigramme)"
                                                     style="width: 100%; height: 100%; object-fit: cover;" />
                                            </div>

                                            <!-- Actions Container -->
                                            <div class="flex gap-2 justify-content-center w-full">
                                                <p-button icon="pi pi-trash"
                                                          severity="danger"
                                                          [rounded]="true"
                                                          (click)="confirmDeleteOrganigram(this.getDecryptedId(), organigramme)"
                                                          pTooltip="Supprimer">
                                                </p-button>
                                                <p-button icon="pi pi-download"
                                                          severity="secondary"
                                                          [rounded]="true"
                                                          (click)="downloadOrganigramme(organigramme)"
                                                          pTooltip="Télécharger">
                                                </p-button>
                                            </div>
                                        </div>
                                    </p-card>
                                </div>
                            </div>

                            <!-- File Upload Section -->
                            <div class="mt-4">
                                <p-fileUpload mode="advanced"
                                              [multiple]="true"
                                              accept="image/*,.pdf"
                                              [maxFileSize]="1000000"
                                              (onSelect)="onFileSelect($event, 'organigrammes')"
                                              [showCancelButton]="false"
                                              styleClass="w-full"
                                              chooseLabel="Sélectionner des fichiers">
                                    <ng-template pTemplate="content">
                                        <div class="flex align-items-center flex-column gap-2">
                                            <i class="pi pi-upload text-4xl"></i>
                                            <span>Glissez et déposez les fichiers ici</span>
                                        </div>
                                    </ng-template>
                                </p-fileUpload>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Client Tab -->
                <p-tabPanel header="Clients">


                    <p-table
                        #dt
                        [value]="clients"
                        [paginator]="true"
                        [rows]="25"
                        [showCurrentPageReport]="true"
                        [rowsPerPageOptions]="[2,10,25,50]"
                        styleClass="p-datatable-striped"
                        [expandedRowKeys]="expandedRows"
                        dataKey="id"
                        [globalFilterFields]="['nom','societeMere','adresse','rcs','villeRcs','siret']"
                        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">

                        <ng-template pTemplate="caption">
                            <div class="flex justify-content-between align-items-center">
                                <h5 class="m-0">Liste des clients de la société</h5>
                                <div>
                                </div>
                            </div>
                        </ng-template>

                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 6rem">Nom et Prénom</th>
                                <th>Société</th>
                                <th pSortableColumn="dateDerniereMiseAJour">Dernière MAJ <p-sortIcon field="dateDerniereMiseAJour"></p-sortIcon></th>

                                <th pSortableColumn="genre">Genre <p-sortIcon field="genre"></p-sortIcon></th>
                                <th >E-mails</th>
                                <th>Téléphones</th>
                                <th pSortableColumn="localisation">Localisation <p-sortIcon field="localisation"></p-sortIcon></th>
                                <th pSortableColumn="statut">Statut <p-sortIcon field="statut"></p-sortIcon></th>
                                <th pSortableColumn="modeDeFonctionnement">Mode fonctionnement <p-sortIcon field="modeDeFonctionnement"></p-sortIcon></th>
                                <th pSortableColumn="preferenceDeCommunication">Préférence communication <p-sortIcon field="preferenceDeCommunication"></p-sortIcon></th>
                                <th >Organigramme </th>
                                <th>Référentiel</th>
                                <th>LinkedIn</th>
                                <th>Prospection</th>
                                <th pSortableColumn="besoins">Besoins<p-sortIcon field="besoins"></p-sortIcon></th>
                                <th style="width: 5rem">Actions</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-client>
                            <tr>
                                <td>{{client.nom}} {{client.prenom}}</td>
                                <td>{{client?.societe?.nom}}</td>
                                <td>{{ client.dateDerniereMiseAJour ? (client.dateDerniereMiseAJour | date: 'dd/MM/yyyy') : 'N/A' }}</td>

                                <td>{{client.genre}}</td>
                                <td>
                                    <div class="email-container">
                                        <div class="email-row">
                                            <a *ngIf="client.email" [href]="'mailto:' + client.email" title="{{ client.email }}">
                                                <span class="label-mail">Pri:</span>
                                                <i class="pi pi-envelope" style="font-size: 1.2rem; margin-left: 0.5rem;"></i>
                                            </a>
                                        </div>
                                        <div class="email-row">
                                            <a *ngIf="client.emailSecondaire" [href]="'mailto:' + client.emailSecondaire" title="{{ client.emailSecondaire }}" class="email-link">
                                                <span class="label-mail">Sec:</span>
                                                <i class="pi pi-envelope" style="font-size: 1.2rem; margin-left: 0.5rem;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </td>




                                <td>
                                    <div class="contact-container">
                                        <div class="contact-row">
                                            <a *ngIf="client.telephonePrso" [href]="'tel:' + client.telephonePrso" title="{{ client.telephonePrso }}">
                                                <span class="label">Perso:</span>
                                                <i class="pi pi-phone" style="font-size: 1.2rem; margin-left: 0.5rem;"></i>
                                            </a>
                                        </div>
                                        <div class="contact-row">
                                            <a *ngIf="client.telephonePro" [href]="'tel:' + client.telephonePro" title="{{ client.telephonePro }}">
                                                <span class="label">Proff:</span>
                                                <i class="pi pi-phone" style="font-size: 1.2rem; margin-left: 0.5rem;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </td>


                                <td>{{client.localisation}}</td>
                                <td>{{client.statut}}</td>
                                <td>{{client.modeDeFonctionnement}}</td>
                                <td>{{client.preferenceDeCommunication}}</td>
                                <td>
                                    <a (click)="showOrganigramme(client)"  title="Plus d'informations">
                                        <i class="pi pi-sitemap" style="font-size: 2rem"></i>
                                    </a>
                                </td>

                                <td>
                                    <a (click)="showReferentiel(client)" title="Référentiel">
                                        <i class="fas fa-folder-tree" style="font-size: 1.5rem"></i>
                                    </a>
                                </td>
                                <td>
                                    <a (click)="showLinkedIn(client)" title="LinkedIn"  target="_blank">
                                        <i class="fab fa-linkedin" style="font-size: 1.5rem"></i>
                                    </a>
                                </td>

                                <td>
                                    <a (click)="showProspection(client)" title="Prospection" target="_blank">
                                        <i class="pi pi-chart-line" style="font-size: 1.5rem"></i>
                                    </a>
                                </td>

                                <td>{{client?.besoins?.length}} </td>


                                <td>
                                    <button pButton
                                            icon="pi pi-pencil"
                                            (click)="openDialog(client.id)"
                                            type="button"
                                            class="p-button-rounded p-button-outlined p-button-sm"
                                            pTooltip="Edit">
                                    </button>
                                </td>
                            </tr>
                        </ng-template>


                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="10" class="text-center p-4">
                                    <div class="flex flex-column align-items-center">
                                        <i class="pi pi-building text-700" style="font-size: 2rem"></i>
                                        <span class="text-700 mt-2">No clients found.</span>
                                    </div>
                                </td>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="loadingbody">
                            <tr>
                                <td colspan="10" class="text-center p-4">
                                    <i class="pi pi-spin pi-spinner mr-2"></i>
                                    Loading clients data...
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>









                    <div *ngIf="clients.length==0" class="p-3">
                        <div class="flex align-items-center justify-content-center" style="height: 200px">
                            <div class="text-center">
                                <i class="pi pi-users text-4xl text-primary-200 mb-3"></i>
                                <p class="text-600">Aucun client associé a cette société...</p>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Besoin Tab -->
                <p-tabPanel header="Besoins">
                    <div class="p-3">
                        <!-- Header section with add button -->
                        <div class="flex justify-content-between align-items-center mb-4">
                            <p-button
                                label="Nouveau Besoin"
                                icon="pi pi-plus"
                                class="p-button-success"
                                (click)="showAddBesoinDialog()">
                            </p-button>
                        </div>
                        <div *ngIf="societe.besoins?.length > 0; else noBesoins" class="grid">
                            <div *ngFor="let besoin of societe.besoins" class="col-12 md:col-6 lg:col-4">
                                <p-card class="h-full shadow-2 hover:shadow-4 transition-duration-300">
                                    <!-- Card Header -->
                                    <ng-template pTemplate="header">
                                        <div class="p-3 border-bottom-1 surface-border">
                                            <div class="text-xl font-semibold mb-2">{{ besoin.titre }}</div>
                                            <div class="text-500">
                                                <i class="pi pi-calendar mr-2"></i>
                                                {{ besoin.dateDeCreation | date:'short' }}
                                            </div>
                                        </div>
                                    </ng-template>

                                    <!-- Card Content -->
                                    <div class="p-3">
                                        <div class="mb-3 flex align-items-center">
                                            <span class="font-semibold w-8rem">Référence:</span>
                                            <span class="text-600">{{ besoin.reference || 'N/A' }}</span>
                                        </div>

                                        <div class="mb-3 flex align-items-center">
                                            <span class="font-semibold w-8rem">État:</span>
                                            <p-tag [severity]="getEtatSeverity(besoin.etat)" [value]="besoin.etat || 'N/A'"></p-tag>
                                        </div>

                                        <!-- QR Code Section -->
                                        <div *ngIf="besoin.qrCodeImage" class="mb-3 flex flex-column align-items-center">
                                            <img [src]="besoin.qrCodeImage.imagenUrl"
                                                 alt="QR Code for {{ besoin.titre }}"
                                                 width="120"
                                                 class="border-round shadow-1">
                                        </div>

                                        <!-- Profil Section -->
                                        <div *ngIf="besoin.profilBesoins" class="mt-3 p-3 surface-ground border-round">
                                            <div class="font-semibold mb-2">Profil recherché</div>
                                            <div class="grid">
                                                <div class="col-12 mb-2">
                                                    <i class="pi pi-star mr-2"></i>
                                                    <span class="font-medium">Difficultés:</span> {{ besoin.profilBesoins.difficultes }}
                                                </div>
                                                <div class="col-12 mb-2">
                                                    <i class="pi pi-users mr-2"></i>
                                                    <span class="font-medium">Seniorité:</span> {{ besoin.profilBesoins.seniorite }}
                                                </div>
                                                <div class="col-12">
                                                    <i class="pi pi-briefcase mr-2"></i>
                                                    <span class="font-medium">Expérience:</span> {{ besoin.profilBesoins.anneesExperienceTotales }} ans
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Card Footer -->
                                    <ng-template pTemplate="footer">
                                        <div class="flex justify-content-between">
                                            <p-button
                                                label="Details"
                                                icon="pi pi-eye"
                                                (click)="showViewBesoinDialog(besoin.id)"
                                                class="p-button-text">
                                            </p-button>
                                            <div class="flex gap-2">
                                                <p-button
                                                    icon="pi pi-pencil"
                                                    class="p-button-rounded p-button-secondary p-button-outlined"
                                                    (click)="editBesoin(besoin)"
                                                    pTooltip="Modifier">
                                                </p-button>
                                                <p-button
                                                    icon="pi pi-trash"
                                                    class="p-button-rounded p-button-danger p-button-outlined"
                                                    (click)="confirmDeleteBesoin(besoin.id)"
                                                    pTooltip="Supprimer">
                                                </p-button>
                                            </div>
                                        </div>
                                    </ng-template>
                                </p-card>
                            </div>
                        </div>
                        <ng-template #noBesoins>
                            <div class="flex align-items-center justify-content-center" style="height: 200px">
                                <div class="text-center">
                                    <i class="pi pi-briefcase text-4xl text-primary-200 mb-3"></i>
                                    <p class="text-600">Aucun besoin n'a été trouvé pour cette société...</p>
                                </div>
                            </div>
                        </ng-template>
                    </div>

                    <!-- Besoin Update -->
                    <p-sidebar [(visible)]="displayBesoinSidebar" position="right" [modal]="true" [dismissible]="false"
                               [baseZIndex]="10000" styleClass="custom-sidebar w-25vw">
                        <ng-template pTemplate="header">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-pencil"></i>
                                <span class="font-bold text-xl">Modifier Besoin</span>
                            </div>
                        </ng-template>

                        <form [formGroup]="besoinForm" (ngSubmit)="saveBesoin()" class="p-4">
                            <p-panel header="Informations de base" [toggleable]="true" styleClass="mb-3">
                                <div class="grid">
                                    <div class="col-12 lg:col-6 field">
                                        <label for="titre" class="font-medium">Titre*</label>
                                        <span class="p-input-icon-left w-full">
                    <i class="pi pi-tag"></i>
                    <input id="titre" formControlName="titre" pInputText class="w-full" placeholder="Entrez le titre"/>
                  </span>
                                    </div>



                                    <div class="col-12 lg:col-6 field">
                                        <label for="etat" class="font-medium">État*</label>
                                        <p-dropdown
                                            id="etat"
                                            formControlName="etat"
                                            [options]="states"
                                            optionLabel="label"
                                            optionValue="value"
                                            placeholder="Sélectionnez l'état"
                                            styleClass="w-full">
                                        </p-dropdown>
                                    </div>


                                    <div class="col-12 lg:col-6 field">
                                        <label for="dateDeDemarrage" class="font-medium">Date de Démarrage</label>
                                        <p-calendar formControlName="dateDeDemarrage" dateFormat="yy-mm-dd"
                                                    [showIcon]="true" styleClass="w-full"></p-calendar>
                                    </div>

                                    <div class="col-12 lg:col-6 field">
                                        <label for="plateforme" class="font-medium">Plateforme</label>
                                        <span class="p-input-icon-left w-full">
                    <i class="pi pi-desktop"></i>
                    <input id="plateforme" formControlName="plateforme" pInputText class="w-full" placeholder="Enter platform"/>
                  </span>
                                    </div>

                                    <div class="col-12">
                                        <p-divider></p-divider>
                                    </div>

                                    <div class="col-12 md:col-4 field">
                                        <p-checkbox formControlName="besoinEnAvanceDePhase" binary="true"
                                                    label="Avance de Phase"></p-checkbox>
                                    </div>
                                    <div class="col-12 md:col-4 field">
                                        <p-checkbox formControlName="reccurent" binary="true"
                                                    label="Récurrent"></p-checkbox>
                                    </div>
                                    <div class="col-12 md:col-4 field">
                                        <p-checkbox formControlName="habilitable" binary="true"
                                                    label="Habilitable"></p-checkbox>
                                    </div>
                                </div>



                            </p-panel>


                            <p-panel header="Référentiel" [toggleable]="true" styleClass="p-panel">
                                <div formGroupName="referentiel" class="p-fluid p-grid p-formgrid">
                                    <!-- Gestion des Profils -->
                                    <div formArrayName="profilReferentiels">
                                        <div *ngFor="let profilReferentiel of profilReferentiels.controls; let i = index" [formGroupName]="i" class="p-grid p-formgrid">
                                            <div class="p-field p-col-12 p-md-6">
                                                <label for="profil-{{ i }}" class="p-d-block font-bold mb-2">Profil*</label>
                                                <p-dropdown
                                                    id="profil-{{ i }}"
                                                    [options]="availableProfils[i]"
                                                    placeholder="Sélectionnez un profil"
                                                    formControlName="profil"
                                                    class="p-d-block"
                                                    (onChange)="onProfilChange(i)"
                                                ></p-dropdown>
                                            </div>

                                            <div class="p-field p-col-12 p-md-6">
                                                <label for="niveau-{{ i }}" class="p-d-block font-bold mb-2">Niveau*</label>
                                                <p-dropdown
                                                    id="niveau-{{ i }}"
                                                    [options]="niveauxTechnos"
                                                    placeholder="Sélectionnez un niveau"
                                                    formControlName="niveau"
                                                    class="p-d-block"
                                                ></p-dropdown>
                                            </div>

                                            <!-- Boutons d'ajout et de suppression sous chaque profil -->
                                            <div class="p-field text-right mt-2">
                                                <button
                                                    pButton
                                                    icon="pi pi-plus"
                                                    class="p-button-rounded p-button-primary mr-2"
                                                    (click)="addProfilReferentielUpdate()"
                                                    title="Ajouter un profil"
                                                    type="button"
                                                ></button>
                                                <button
                                                    pButton
                                                    icon="pi pi-minus"
                                                    class="p-button-rounded p-button-danger"
                                                    (click)="removeProfilReferentielUpdate(i)"
                                                    title="Supprimer ce profil"
                                                    *ngIf="profilReferentiels.length > 1"
                                                    type="button"
                                                ></button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Gestion des Segments -->
                                    <div class="p-field p-col-12 p-md-6">
                                        <label for="segments" class="p-d-block font-bold mb-2">Segments*</label>
                                        <p-multiSelect
                                            id="segments"
                                            [options]="segments"
                                            placeholder="Sélectionnez un segment"
                                            formControlName="segments"
                                            (onChange)="onSegmentChange($event)"
                                            class="p-d-block"
                                        ></p-multiSelect>
                                    </div>

                                    <!-- Sous-segments -->
                                    <div class="p-field p-col-12 p-md-6">
                                        <label for="sousSegments" class="p-d-block font-bold mb-2">Sous-segments*</label>
                                        <p-multiSelect
                                            id="sousSegments"
                                            [options]="sousSegmentsOptions"
                                            placeholder="Sélectionnez un sous-segment"
                                            formControlName="sousSegments"
                                            (onChange)="onTechnoChange($event)"
                                            class="p-d-block"
                                        ></p-multiSelect>
                                    </div>

                                    <!-- Technologies -->
                                    <div class="p-field p-col-12 p-md-6">
                                        <label for="technologie" class="p-d-block font-bold mb-2">Technologies*</label>
                                        <p-multiSelect
                                            id="technologie"
                                            [options]="technologiesOptions"
                                            (onChange)="filterTechnoUpdate()"
                                            placeholder="Sélectionnez les technologies"
                                            formControlName="technologie"
                                            class="p-d-block"
                                        ></p-multiSelect>
                                    </div>
                                </div>
                            </p-panel>



                            <br>

                            <p-panel header="Niveaux de technologies demandés" [toggleable]="true" styleClass="p-panel">
                                <div formArrayName="besoinsTechnologies" class="p-fluid p-grid p-formgrid">
                                    <div *ngFor="let tech of besoinsTechnologiesArray.controls; let i = index" [formGroupName]="i" class="p-field mb-4">
                                        <div class="p-card p-3 mb-3 shadow-2">
                                            <div class="flex justify-between items-center">
                                                <button
                                                    *ngIf="besoinsTechnologiesArray.length > 1"
                                                    pButton
                                                    type="button"
                                                    icon="pi pi-trash"
                                                    class="p-button-rounded p-button-danger p-button-text"
                                                    (click)="removeBesoinTechnologieUpdate(i)"
                                                    tooltip="Supprimer ce niveau">
                                                </button>
                                            </div>

                                            <div class="p-field mt-3">
                                                <label class="font-bold">Technologie*</label>
                                                <p-dropdown
                                                    placeholder="Sélectionnez les technologies"
                                                    [options]="availableTechnologies[i]"
                                                    (onChange)="onTechnologieChangeUpdate(i)"
                                                    formControlName="technologie">
                                                </p-dropdown>
                                            </div>

                                            <div class="col-12 md:col-6">
                                                <div class="p-field mb-3">
                                                    <label class="font-bold">Années d'expérience*</label>
                                                    <p-inputNumber
                                                        placeholder="Saisir les années d'expérience"
                                                        formControlName="anneesExperience">

                                                        name="tjmMinEstime" [min]="0" [showButtons]="true"
                                                        mode="currency" currency="EUR" minFractionDigits="0"
                                                        maxFractionDigits="0" required>
                                                    </p-inputNumber>
                                                </div>
                                            </div>

                                            <div class="p-field mt-3">
                                                <label class="font-bold">Niveau*</label>
                                                <p-dropdown
                                                    placeholder="Sélectionnez le niveau"
                                                    [options]="niveauxTechnos"
                                                    formControlName="niveau">
                                                </p-dropdown>
                                            </div>

                                            <div class="p-field mt-3">
                                                <label class="font-bold">Importance*</label>
                                                <p-dropdown
                                                    placeholder="Sélectionnez l'importance"
                                                    [options]="importanceOptions"
                                                    formControlName="importance">
                                                </p-dropdown>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex justify-content-center mt-3">
                                        <button
                                            pButton
                                            label="Ajouter un niveau pour une technologie demandée"
                                            icon="pi pi-plus"
                                            class="p-button-rounded p-button-primary"
                                            type="button"
                                            (click)="addBesoinTechnologieUpdate()"
                                            [disabled]="isButtonDisabled()">
                                        </button>

                                    </div>


                                </div>
                            </p-panel>


                            <p-panel header="Profil Besoin" [toggleable]="true" styleClass="mb-3">
                                <div formGroupName="profilBesoins" class="grid">
                                    <div class="col-12 field">
                                        <label for="difficultes" class="font-medium">Difficultés</label>
                                        <textarea id="difficultes" formControlName="difficultes" rows="3"
                                                  pInputTextarea class="w-full" placeholder="Describe difficulties"></textarea>
                                    </div>

                                    <div class="col-12 lg:col-6 field">
                                        <label for="seniorite" class="font-medium">Seniorité</label>
                                        <p-dropdown
                                            id="seniorite"
                                            formControlName="seniorite"
                                            [options]="seniorityLevels"
                                            optionLabel="label"
                                            optionValue="value"
                                            placeholder="Sélectionnez la séniorité"
                                            styleClass="w-full">
                                        </p-dropdown>
                                    </div>


                                    <div class="col-12 lg:col-6 field">
                                        <label for="anneesExperienceTotales" class="font-medium">Années d'Expérience</label>
                                        <p-inputNumber formControlName="anneesExperienceTotales" [showButtons]="true"
                                                       buttonLayout="horizontal" spinnerMode="horizontal"
                                                       decrementButtonClass="p-button-secondary" incrementButtonClass="p-button-secondary"
                                                       incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus"
                                                       class="w-full"></p-inputNumber>
                                    </div>

                                    <div class="col-12">
                                        <p-fieldset legend="TJM Details" [toggleable]="true">
                                            <div class="grid">
                                                <div class="col-12 lg:col-6 field">
                                                    <label for="tjmMinEstime" class="font-medium">TJM Min Estimé</label>
                                                    <p-inputNumber
                                                        formControlName="tjmMinEstime"
                                                        mode="currency"
                                                        currency="EUR"
                                                        minFractionDigits="0"
                                                        maxFractionDigits="0"
                                                        styleClass="w-full"
                                                        [min]="200"
                                                        [max]="2000"
                                                        [step]="5">
                                                    </p-inputNumber>
                                                </div>

                                                <div class="col-12 lg:col-6 field">
                                                    <label for="tjmMaxEstime" class="font-medium">TJM Max Estimé</label>
                                                    <p-inputNumber formControlName="tjmMaxEstime" mode="currency" currency="EUR"
                                                                   minFractionDigits="0"
                                                                   maxFractionDigits="0" styleClass="w-full"></p-inputNumber>
                                                </div>
                                                <div class="col-12 lg:col-6 field">
                                                    <label for="tjmMin" class="font-medium">TJM Minimum</label>
                                                    <p-inputNumber formControlName="tjmMin" mode="currency" currency="EUR"
                                                                   minFractionDigits="0"
                                                                   maxFractionDigits="0" styleClass="w-full"></p-inputNumber>
                                                </div>
                                                <div class="col-12 lg:col-6 field">
                                                    <label for="tjmMax" class="font-medium">TJM Maximum</label>
                                                    <p-inputNumber formControlName="tjmMax" mode="currency" currency="EUR"
                                                                   minFractionDigits="0"
                                                                   maxFractionDigits="0" styleClass="w-full"></p-inputNumber>
                                                </div>
                                                <div class="col-12 field">
                                                    <label for="tjmSouhaite" class="font-medium">TJM Souhaité</label>
                                                    <p-inputNumber formControlName="tjmSouhaite" mode="currency" currency="EUR" minFractionDigits="0"
                                                                   maxFractionDigits="0" styleClass="w-full"></p-inputNumber>
                                                </div>
                                            </div>
                                        </p-fieldset>
                                    </div>

                                    <div class="col-12 field">
                                        <label for="avantages" class="font-medium">Points Forts mission / avantages</label>
                                        <textarea id="avantages" formControlName="avantages" rows="3"
                                                  pInputTextarea class="w-full" placeholder="Ajoutez vos Points Forts mission / avantages"></textarea>
                                    </div>

                                    <div class="col-12 field">
                                        <label for="commentaire" class="font-medium">Commentaire</label>
                                        <textarea id="commentaire" formControlName="commentaire" rows="3"
                                                  pInputTextarea class="w-full" placeholder="Ajoutez vos commentaires"></textarea>
                                    </div>
                                </div>
                            </p-panel>

                            <div class="flex justify-content-end gap-2 mt-4">
                                <p-button label="Anuuler" icon="pi pi-times" (click)="displayBesoinSidebar = false"
                                          styleClass="p-button-secondary"></p-button>
                                <button pButton label="Enregistrer" type="submit" ></button>
                            </div>
                        </form>
                    </p-sidebar>

                    <!-- Besoin Add Dialog -->
                    <p-dialog [(visible)]="displayBesoinDialog" [header]="'Ajouter un nouveau besoin'" [modal]="true"
                              [style]="{ width: '70vw' }" [closable]="true" styleClass="p-fluid">
                        <form #addBesoinForm="ngForm" (ngSubmit)="onSubmitBesoin(addBesoinForm)" class="p-fluid">

                            <!-- Main Information Card -->
                            <p-card styleClass="mb-4">
                                <ng-template pTemplate="header">
                                    <div class="text-xl font-bold mb-2 p-3 bg-primary-50" >Informations Principales</div>
                                </ng-template>

                                <div class="grid">
                                    <div class="col-12 md:col-6">
                                        <div class="p-field mb-4">
                                            <label for="titre" class="font-bold">Titre*</label>
                                            <span class="p-input-icon-left w-full">
            <i class="pi pi-tag"></i>
            <input id="titre"
                   [(ngModel)]="besoin.titre"
                   name="titre"
                   required
                   placeholder="Entrez le titre du besoin" pInputText class="w-full"/>
          </span>
                                        </div>

                                        <div class="p-field mb-4">
                                            <label for="etat" class="font-bold">État*</label>
                                            <p-dropdown id="etat" [(ngModel)]="besoin.etat" name="etat"
                                                        [options]="states" placeholder="Sélectionnez l'état"
                                                        styleClass="w-full" required>
                                            </p-dropdown>
                                        </div>

                                        <div class="p-field mb-4">
                                            <label for="dateDeDemarrage" class="font-bold">Date de Démarrage*</label>
                                            <p-calendar id="dateDeDemarrage" [(ngModel)]="besoin.dateDeDemarrage"
                                                        name="dateDeDemarrage" [showTime]="true" required
                                                        styleClass="w-full" [showIcon]="true">
                                            </p-calendar>
                                        </div>
                                    </div>

                                    <div class="col-12 md:col-6">
                                        <div class="flex flex-column gap-3">
                                            <div class="p-field-checkbox">
                                                <p-checkbox id="besoinEnAvanceDePhase" [(ngModel)]="besoin.besoinEnAvanceDePhase"
                                                            name="besoinEnAvanceDePhase" [binary]="true">
                                                </p-checkbox>
                                                <label for="besoinEnAvanceDePhase" class="ml-2">Besoin en Avance de Phase</label>
                                            </div>

                                            <div class="p-field-checkbox">
                                                <p-checkbox id="reccurent" [(ngModel)]="besoin.reccurent"
                                                            name="reccurent" [binary]="true">
                                                </p-checkbox>
                                                <label for="reccurent" class="ml-2">Récurrent</label>
                                            </div>

                                            <div class="p-field-checkbox">
                                                <p-checkbox id="demarrageASAP" [(ngModel)]="besoin.demarrageASAP"
                                                            name="demarrageASAP" [binary]="true">
                                                </p-checkbox>
                                                <label for="demarrageASAP" class="ml-2">Démarrage ASAP</label>
                                            </div>

                                            <div class="p-field-checkbox">
                                                <p-checkbox id="habilitable" [(ngModel)]="besoin.habilitable"
                                                            name="habilitable" [binary]="true">
                                                </p-checkbox>
                                                <label for="habilitable" class="ml-2">Habilitable</label>
                                            </div>






                                        </div>
                                    </div>
                                </div>
                            </p-card>

                            <p-card styleClass="mb-4">
                                <ng-template pTemplate="header">
                                    <div class="text-xl font-bold mb-2 p-3 bg-primary-50">Référentiel</div>
                                </ng-template>

                                <!-- Liste des Profils -->
                                <div class="p-field mb-4">
                                    <label class="font-bold">Profils*</label>
                                    <div *ngFor="let profilReferentiel of besoin.referentiel?.profilReferentiels; let i = index" class="mb-3">
                                        <div class="grid">
                                            <!-- Profil -->
                                            <div class="col-6">
                                                <p-dropdown
                                                    id="profile-{{ i }}"
                                                    [options]="availableProfils[i] || originalProfils"
                                                    placeholder="Sélectionnez un profil"
                                                    [(ngModel)]="profilReferentiel.profil"
                                                    [ngModelOptions]="{ standalone: true }"
                                                    (onChange)="onProfilChangeAdd(i)"
                                                ></p-dropdown>
                                            </div>

                                            <!-- Niveau -->
                                            <div class="col-6">
                                                <p-dropdown
                                                    id="niveau-{{ i }}"
                                                    [options]="niveauxTechnos"
                                                    placeholder="Sélectionnez un niveau"
                                                    [(ngModel)]="besoin.referentiel?.profilReferentiels[i].niveau"
                                                    [ngModelOptions]="{ standalone: true }"
                                                ></p-dropdown>
                                            </div>
                                        </div>

                                        <!-- Boutons + et - alignés sur une seule ligne -->
                                        <div class="p-field text-right">
                                            <button
                                                pButton
                                                icon="pi pi-plus"
                                                class="p-button-rounded p-button-primary mr-2"
                                                (click)="addProfilReferentiel()"
                                                title="Ajouter un profil"
                                                type="button"
                                            ></button>
                                            <button
                                                pButton
                                                icon="pi pi-minus"
                                                class="p-button-rounded p-button-danger"
                                                (click)="removeProfilReferentiel(i)"
                                                title="Supprimer ce profil"
                                                *ngIf="besoin.referentiel?.profilReferentiels.length > 1"

                                                type="button"
                                            ></button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Segments -->
                                <div class="p-field mb-4">
                                    <label class="font-bold">Segment*</label>
                                    <p-multiSelect
                                        id="segments"
                                        [options]="segments"
                                        placeholder="Sélectionnez un segment"
                                        [(ngModel)]="besoin.referentiel.segments"
                                        [ngModelOptions]="{ standalone: true }"
                                        (onChange)="onSegmentChange($event)"
                                    ></p-multiSelect>
                                </div>

                                <!-- Sous-segments -->
                                <div class="p-field mb-4">
                                    <label class="font-bold">Sous-segment*</label>
                                    <p-multiSelect
                                        id="sous-segment"
                                        [options]="sousSegmentsOptions"
                                        placeholder="Sélectionnez un sous-segment"
                                        [(ngModel)]="besoin.referentiel.sousSegments"
                                        [ngModelOptions]="{ standalone: true }"
                                        (onChange)="onTechnoChange($event)"
                                    ></p-multiSelect>
                                </div>

                                <!-- Technologies -->
                                <div class="p-field mb-4">
                                    <label class="font-bold">Technologies*</label>
                                    <p-multiSelect
                                        placeholder="Sélectionnez les technologies"
                                        [options]="technologiesOptions"
                                        (onChange)="filterTechno()"
                                        [(ngModel)]="besoin.referentiel.technologie"
                                        [ngModelOptions]="{ standalone: true }"
                                    ></p-multiSelect>
                                </div>
                            </p-card>





                            <p-card styleClass="mb-4">
                                <ng-template pTemplate="header">
                                    <div class="text-xl font-bold mb-2 p-3 bg-primary-50">Niveaux de technologies demandés</div>
                                </ng-template>

                                <!-- Boucle sur les besoinsTechnologies -->
                                <div *ngFor="let tech of besoin.besoinsTechnologies; let i = index" class="p-field mb-4">
                                    <div class="p-card p-3 mb-3 shadow-2">
                                        <div class="flex justify-between items-center">
                                            <!--                        <h4 class="font-bold text-primary-600">Technologie {{ i + 1 }}</h4>-->
                                            <button *ngIf="besoin.besoinsTechnologies.length > 1" pButton type="button" icon="pi pi-trash"
                                                    class="p-button-rounded p-button-danger p-button-text"
                                                    (click)="removeBesoinTechnologie(i)"
                                                    tooltip="Supprimer ce niveau"></button>
                                        </div>

                                        <div class="p-field mt-3">
                                            <label class="font-bold">Technologie*</label>
                                            <p-dropdown
                                                placeholder="Sélectionnez les technologies"
                                                [options]="availableTechnologies[i]"
                                                (onChange)="onTechnologieChange(i)"
                                                [(ngModel)]="besoin.besoinsTechnologies[i].technologie" [ngModelOptions]="{standalone: true}">
                                            </p-dropdown>
                                        </div>
                                        <div class="p-field mb-4">
                                            <label for="anneesExperience" class="font-bold">Années d'Expérience*</label>
                                            <!--                        <p-inputNumber id="anneesExperience" [(ngModel)]="besoin.besoinsTechnologies[i].anneesExperience"-->
                                            <!--                                       name="anneesExperience" [min]="0" [showButtons]="true" required>-->
                                            <!--                        </p-inputNumber>-->
                                            <p-inputNumber
                                                placeholder="Saisir les années d'expérience"
                                                [(ngModel)]="besoin.besoinsTechnologies[i].anneesExperience" [ngModelOptions]="{standalone: true}">
                                                name="annesexprUpdate" [min]="0" [showButtons]="true" required>
                                            </p-inputNumber>
                                        </div>
                                        <div class="p-field mt-3">
                                            <label class="font-bold">Niveau*</label>
                                            <p-dropdown
                                                placeholder="Sélectionnez le niveau"
                                                [options]="niveauxTechnos"
                                                [(ngModel)]="besoin.besoinsTechnologies[i].niveau" [ngModelOptions]="{standalone: true}">
                                            </p-dropdown>
                                        </div>

                                        <div class="p-field mt-3">
                                            <label class="font-bold">Importance*</label>
                                            <p-dropdown
                                                placeholder="Sélectionnez l'importance"
                                                [options]="importanceOptions"
                                                [(ngModel)]="besoin.besoinsTechnologies[i].importance" [ngModelOptions]="{standalone: true}">
                                            </p-dropdown>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bouton pour ajouter un niveau -->
                                <div class="flex justify-content-center mt-3">
                                    <button pButton
                                            label="Ajouter un niveau pour une technologie demandée"
                                            icon="pi pi-plus"
                                            class="p-button-rounded p-button-primary"
                                            (click)="addBesoinTechnologie()">
                                    </button>
                                </div>

                            </p-card>


                            <!-- Profil Besoin Card -->
                            <p-card styleClass="mb-4">
                                <ng-template pTemplate="header">
                                    <div class="text-xl font-bold mb-2 p-3 bg-primary-50">Profil du Besoin</div>
                                </ng-template>

                                <div class="grid">
                                    <div class="col-12 md:col-6">
                                        <div class="p-field mb-4">
                                            <label for="difficultes" class="font-bold">Difficultés*</label>
                                            <span class="p-input-icon-left w-full">
                          <i class="pi pi-desktop"></i>
                          <input id="ifficultes"
                                 [(ngModel)]="profilBesoin.difficultes"
                                 name="titre"
                                 required
                                 placeholder="Décrivez les difficultés" pInputText class="w-full"/>
                        </span>
                                        </div>

                                        <div class="p-field mb-4">
                                            <label for="seniorite" class="font-bold">Seniorité*</label>
                                            <p-dropdown id="seniorite" [(ngModel)]="profilBesoin.seniorite"
                                                        name="seniorite" [options]="senioriteOptions"
                                                        placeholder="Sélectionnez le niveau" styleClass="w-full" required>
                                            </p-dropdown>
                                        </div>

                                        <div class="p-field mb-4">
                                            <label for="anneesExperienceTotales" class="font-bold">Années d'Expérience*</label>
                                            <p-inputNumber id="anneesExperienceTotales" [(ngModel)]="profilBesoin.anneesExperienceTotales"
                                                           name="anneesExperienceTotales" [min]="0" [showButtons]="true" required>
                                            </p-inputNumber>
                                        </div>
                                    </div>

                                    <div class="col-12 md:col-6">
                                        <p-fieldset legend="Taux Journaliers Moyens (TJM)" [toggleable]="true">
                                            <div class="grid">
                                                <div class="col-12 md:col-6">
                                                    <div class="p-field mb-3">
                                                        <label class="font-bold">TJM Min Estimé*</label>
                                                        <p-inputNumber [(ngModel)]="profilBesoin.tjmMinEstime"
                                                                       name="tjmMinEstime" [min]="0" [showButtons]="true"
                                                                       mode="currency" currency="EUR" minFractionDigits="0"
                                                                       maxFractionDigits="0" required>
                                                        </p-inputNumber>
                                                    </div>
                                                </div>
                                                <div class="col-12 md:col-6">
                                                    <div class="p-field mb-3">
                                                        <label class="font-bold">TJM Max Estimé*</label>
                                                        <p-inputNumber [(ngModel)]="profilBesoin.tjmMaxEstime"
                                                                       name="tjmMaxEstime" [min]="0" [showButtons]="true"
                                                                       mode="currency" currency="EUR" minFractionDigits="0"
                                                                       maxFractionDigits="0" required>
                                                        </p-inputNumber>
                                                    </div>
                                                </div>
                                                <div class="col-12 md:col-6">
                                                    <div class="p-field mb-3">
                                                        <label class="font-bold">TJM Min*</label>
                                                        <p-inputNumber [(ngModel)]="profilBesoin.tjmMin"
                                                                       name="tjmMin" [min]="0" [showButtons]="true"
                                                                       mode="currency" currency="EUR" minFractionDigits="0"
                                                                       maxFractionDigits="0" required>
                                                        </p-inputNumber>
                                                    </div>
                                                </div>
                                                <div class="col-12 md:col-6">
                                                    <div class="p-field mb-3">
                                                        <label class="font-bold">TJM Max*</label>
                                                        <p-inputNumber [(ngModel)]="profilBesoin.tjmMax"
                                                                       name="tjmMax" [min]="0" [showButtons]="true"
                                                                       mode="currency" currency="EUR" minFractionDigits="0"
                                                                       maxFractionDigits="0" required>
                                                        </p-inputNumber>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="p-field">
                                                        <label class="font-bold">TJM Souhaité*</label>
                                                        <p-inputNumber [(ngModel)]="profilBesoin.tjmSouhaite"
                                                                       name="tjmSouhaite" [min]="0" [showButtons]="true"
                                                                       mode="currency" currency="EUR" minFractionDigits="0"
                                                                       maxFractionDigits="0" required>
                                                        </p-inputNumber>
                                                    </div>
                                                </div>
                                            </div>
                                        </p-fieldset>
                                    </div>


                                    <div class="col-12">
                                        <div class="p-field">
                                            <label for="avantages" class="font-bold">Points Forts mission / avantages *</label>
                                            <textarea pInputTextarea id="avantages" [(ngModel)]="profilBesoin.avantages"
                                                      name="commentaire" rows="4" class="w-full" required
                                                      placeholder="Ajoutez vos Points Forts mission / avantages ici ...">
                        </textarea>
                                        </div>
                                    </div>





                                    <div class="col-12">
                                        <div class="p-field">
                                            <label for="commentaire" class="font-bold">Commentaire*</label>
                                            <textarea pInputTextarea id="commentaire" [(ngModel)]="profilBesoin.commentaire"
                                                      name="commentaire" rows="4" class="w-full" required
                                                      placeholder="Ajoutez vos commentaires ici...">
                        </textarea>
                                        </div>
                                    </div>
                                </div>
                            </p-card>

                            <!-- Footer Buttons -->
                            <div class="flex justify-content-end gap-2">
                                <p-button label="Annuler" icon="pi pi-times" (click)="displayBesoinDialog = false"
                                          styleClass="p-button-secondary p-button-outlined">
                                </p-button>
                                <p-button label="Ajouter" icon="pi pi-check" [disabled]="!addBesoinForm.valid"
                                          type="submit" styleClass="p-button-primary">
                                </p-button>
                            </div>
                        </form>
                    </p-dialog>

                </p-tabPanel>
            </p-tabView>
        </div>

        <div class="flex justify-content-center mt-4">
            <p-button label="Enregistrer les modifications" icon="pi pi-check" type="submit"
                      severity="primary"
                      styleClass="w-auto">
            </p-button>
        </div>
    </p-card>
</form>


<!-- Besoin View Dialog -->
<p-dialog [(visible)]="displayBesoinDetailsDialog"
          [modal]="true"
          [style]="{ width: '55vw' }"
          [closable]="true"
          styleClass="p-fluid custom-dialog">

    <ng-container *ngIf="selectedBesoin; else loading">
        <!-- Header principal -->
        <div class="grid center-content-besoin">
            <div class="col-12">
                <h2 class="title-besoin">{{ selectedBesoin.titre }}</h2>
            </div>
        </div>


        <!-- Informations principales -->
        <div class="grid section">
            <div class="col-6">
                <h3>Informations Générales</h3>
                <p><strong>Référence:</strong> {{ selectedBesoin.reference }}</p>
                <p><strong>État:</strong> {{ selectedBesoin.etat }}</p>
                <p><strong>Créé le:</strong> {{ selectedBesoin.dateDeCreation | date: 'dd MMM yyyy, HH:mm:ss' }}</p>
                <p><strong>Dernière mise à jour:</strong> {{ selectedBesoin.dateDerniereMiseAJour | date: 'dd MMM yyyy, HH:mm:ss'}}</p>
                <p><strong>Plateforme:</strong> {{ selectedBesoin.plateforme || 'Non défini' }}</p>
                <p><strong>Démarrage ASAP:</strong> {{ selectedBesoin.demarrageASAP ? 'Oui' : 'Non' }}</p>
                <p><strong>Date de démarrage:</strong> {{ selectedBesoin.dateDeDemarrage | date: 'dd MMM yyyy, HH:mm:ss' }}</p>
                <p><strong>Besoin en avance de phase:</strong> {{ selectedBesoin.besoinEnAvanceDePhase ? 'Oui' : 'Non' }}</p>
                <p><strong>Récurrent:</strong> {{ selectedBesoin.reccurent ? 'Oui' : 'Non' }}</p>
            </div>
            <div class="col-6">
                <h3>QR Code</h3>
                <div class="qr-code-container">
                    <ng-container *ngIf="selectedBesoin.qrCodeImage; else noQrCode">
                        <img [src]="selectedBesoin.qrCodeImage.imagenUrl" alt="QR Code" class="qr-image" />
                    </ng-container>
                    <ng-template #noQrCode>
                        <p>Aucun QR Code disponible.</p>
                    </ng-template>
                </div>
            </div>

        </div>

        <!-- Profil du besoin -->
        <div class="grid section">
            <div class="col-12">
                <h3>Profil Recherché</h3>
            </div>
            <div class="col-6">
                <p><strong>Difficultés:</strong> {{ selectedBesoin.profilBesoins.difficultes }}</p>
                <p><strong>Séniorité:</strong> {{ selectedBesoin.profilBesoins.seniorite }}</p>
                <p><strong>Années d'expérience:</strong> {{ selectedBesoin.profilBesoins.anneesExperienceTotales }}</p>
            </div>
            <div class="col-6">
                <p><strong>TJM (min - max):</strong> {{ selectedBesoin.profilBesoins.tjmMin }} - {{ selectedBesoin.profilBesoins.tjmMax }} €</p>
                <p><strong>TJM souhaité:</strong> {{ selectedBesoin.profilBesoins.tjmSouhaite }} €</p>
                <p><strong>Avantages:</strong> {{ selectedBesoin.profilBesoins.avantages || 'Non défini' }}</p>
            </div>
        </div>

        <!-- Référentiel -->
        <div class="grid section">
            <div class="col-12">
                <h3>Référentiel</h3>
            </div>
            <div class="col-6">
                <p><strong>Segments:</strong> {{ getSegmentsLabels().join(', ') }}</p>
                <p><strong>Sous-segments:</strong> {{ getSousSegmentsLabels().join(', ') }}</p>
            </div>
            <div class="col-6">
                <p><strong>Profil:</strong> {{ getProfilLabels().join(', ') }}</p>
                <p><strong>Technologies:</strong> {{ getTechnologiesLabels().join(', ') }}</p>
            </div>
        </div>

    </ng-container>

    <!-- Message de chargement -->
    <ng-template #loading>
        <div class="loading">
            <p>Chargement des détails du besoin...</p>
        </div>
    </ng-template>
    <br>
    <p-button label="OK" icon="pi pi-check" (click)="displayBesoinDetailsDialog = false"
              styleClass="p-button-primary p-button-outlined">
    </p-button>
</p-dialog>






<p-dialog
    [(visible)]="displayReferentielDialog"
    [modal]="true"
    [style]="{ width: '60%' }"
    [closable]="true"
    [baseZIndex]="10000"
    [styleClass]="'ref'"
>
    <!-- Header centré -->
    <div class="dialog-header">
        <h2>Informations Référentiel</h2>
    </div>

    <div *ngIf="selectedClient" class="referentiel-container">
        <!-- Profil Information -->
        <div class="referentiel-info">
            <!-- Section Profils -->
            <div class="referentiel-title">
                <p><strong>Profils:</strong></p>
            </div>
            <ul class="referentiel-list">
                <li *ngFor="let profilReferentiel of selectedClient.referentiel.profilReferentiels">
                    <div class="profil-item">
                        <span><strong>Profil:</strong> {{ profilReferentiel.profil }}</span>
                        <span><strong>Niveau:</strong> {{ profilReferentiel.niveau }}</span>
                    </div>
                </li>
            </ul>

            <!-- Autres sections -->
            <p><strong>Segments:</strong> {{ selectedClient.referentiel.segments }}</p>
            <p><strong>Sous-segments:</strong> {{ selectedClient.referentiel.sousSegments }}</p>
            <p><strong>Technologies:</strong> {{ selectedClient.referentiel.technologie }}</p>
        </div>
    </div>
</p-dialog>




<p-dialog
    [(visible)]="displayOrganigrammeDialog"
    [modal]="true"
    [style]="{ width: '60%' }"
    [closable]="true"
    [baseZIndex]="10000"
    [styleClass]="'ref'"
>
    <!-- Header au centre -->
    <div class="dialog-header">
        <h2>Informations Organigramme</h2>
    </div>

    <div *ngIf="selectedClient" class="organigramme-container">
        <!-- Profil Information -->
        <div class="organigramme-info">
            <ul>
                <li>
                    <strong>Niveau de service:</strong>
                    <span>{{ selectedClient.organigramme.serviceNiveau }}</span>
                </li>
                <li>
                    <strong>Taille de l'équipe:</strong>
                    <span>{{ selectedClient.organigramme.tailleEquipe }}</span>
                </li>
                <li>
                    <strong>Pourcentage de prestation:</strong>
                    <span>{{ selectedClient.organigramme.pourcentageDePrestation }}%</span>
                </li>
            </ul>
        </div>
    </div>
</p-dialog>


<p-dialog
    [(visible)]="displayLinkedInDialog"
    [modal]="true"
    [style]="{ width: '60%' }"
    [closable]="true"
    [baseZIndex]="10000"
    [styleClass]="'ref'"
>
    <!-- Header au centre -->
    <div class="dialog-header">
        <h2>Informations LinkedIn</h2>
    </div>

    <div *ngIf="selectedClient" class="organigramme-container">
        <!-- Profil Information -->
        <div class="organigramme-info">
            <ul>
                <li>
                    <strong>Lien:</strong>
                    <span>{{ selectedClient.linkedIn.lien }}</span>
                </li>
                <li>
                    <strong>Titre du travail:</strong>
                    <span>{{ selectedClient.linkedIn.jobTitle }}</span>
                </li>
                <li>
                    <strong>Travail description:</strong>
                    <span>{{ selectedClient.linkedIn.jobDescription }}</span>
                </li>
                <li>
                    <strong>Localisation du travail:</strong>
                    <span>{{ selectedClient.linkedIn.jobLocation }}</span>
                </li>
                <li>
                    <strong>Société antérieure:</strong>
                    <span>{{ selectedClient.linkedIn.previousCompany }}</span>
                </li>
                <li>
                    <strong>Travail antérieur:</strong>
                    <span>{{ selectedClient.linkedIn.previousJob }}</span>
                </li>
                <li>
                    <strong>Description travail antérieur:</strong>
                    <span>{{ selectedClient.linkedIn.previousJobDescription }}</span>
                </li>
                <li>
                    <strong>Liste de compétences:</strong>
                    <span>{{ selectedClient.linkedIn.allSkills }}</span>
                </li>
                <li>
                    <strong>Compétences travail actuel:</strong>
                    <span>{{ selectedClient.linkedIn.skillsJobActuel }}</span>
                </li>
                <li>
                    <strong>Compétences travail précédent:</strong>
                    <span>{{ selectedClient.linkedIn.skillsJobPrecedent }}</span>
                </li>
                <li>
                    <strong>Libellé général:</strong>
                    <span>{{ selectedClient.linkedIn.libelleGeneral }}</span>
                </li>
                <li>
                    <strong>Degré d'activité LinkedIn:</strong>
                    <span>{{ selectedClient.linkedIn.degreActiviteLinkedIn }}</span>
                </li>
                <li>
                    <strong>Informations:</strong>
                    <span>{{ selectedClient.linkedIn.infos }}</span>
                </li>
                <li>
                    <strong>Poste actuel:</strong>
                    <span>{{ selectedClient.linkedIn.posteActuel }}</span>
                </li>
                <li>
                    <strong>Localisation:</strong>
                    <span>{{ selectedClient.linkedIn.localisation }}</span>
                </li>
                <li>
                    <strong>Durée dernière société:</strong>
                    <span>{{ selectedClient.linkedIn.dureeDerniereSociete }}</span>
                </li>
                <li>
                    <strong>Description poste dernière société:</strong>
                    <span>{{ selectedClient.linkedIn.descriptionPosteDerniereSociete }}</span>
                </li>
                <li>
                    <strong>Mots clés:</strong>
                    <span>{{ selectedClient.linkedIn.motsCles }}</span>
                </li>
                <li>
                    <strong>Nombre de push CV:</strong>
                    <span>{{ selectedClient.linkedIn.nbrPushCV }}</span>
                </li>
                <li>
                    <strong>Commentaires:</strong>
                    <span>{{ selectedClient.linkedIn.commentaires }}</span>
                </li>
            </ul>

        </div>
    </div>
</p-dialog>

<p-dialog
    [(visible)]="displayProspectionDialog"
    [modal]="true"
    [style]="{ width: '60%' }"
    [closable]="true"
    [baseZIndex]="10000"
    [styleClass]="'ref'"
>
    <!-- Header au centre -->
    <div class="dialog-header">
        <h2>Informations Prospection</h2>
    </div>

    <div *ngIf="selectedClient" class="organigramme-container">
        <!-- Profil Information -->
        <div class="organigramme-info">
            <ul>
                <li>
                    <strong>Nombre d'appels:</strong>
                    <span>{{ selectedClient?.prospection?.nbrAppels }}</span>
                </li>
                <li>
                    <strong>Nombre de mails:</strong>
                    <span>{{ selectedClient?.prospection?.nbrMails }}</span>
                </li>
                <li>
                    <strong>Date de première action</strong>
                    <span>{{ selectedClient?.prospection?.datePremiereAction  | date: 'dd/MM/yyyy HH:mm'}}</span>
                </li>
                <li>
                    <strong>Date de dernière action</strong>
                    <span>{{ selectedClient?.prospection?.dateDerniereAction  | date: 'dd/MM/yyyy HH:mm'}}</span>
                </li>
                <li>
                    <strong>Nombre de jours depuis dernière action</strong>
                    <span>{{ selectedClient?.prospection?.nbrJoursDepuisDerniereAction }}</span>
                </li>
                <li>
                    <strong>Ajout LinkedIn ?</strong>
                    <span>{{ selectedClient?.prospection?.ajoutLinkedIn }}</span>
                </li>
                <li *ngIf="selectedClient?.prospection?.ajoutLinkedIn == true">
                    <strong>Date d'ajout LinkedIn</strong>
                    <span>{{ selectedClient?.prospection?.dateajoutLinkedIn | date: 'dd/MM/yyyy HH:mm' }}</span>
                </li>
                <li>
                    <strong>LinkedIn accepté ?</strong>
                    <span>{{ selectedClient?.prospection?.linkedInAccepte }}</span>
                </li>
                <li *ngIf="selectedClient?.prospection?.linkedInAccepte == true">
                    <strong>Date d'acceptation LinkedIn</strong>
                    <span>{{ selectedClient?.prospection?.dateAcceptationLinkedIn  | date: 'dd/MM/yyyy HH:mm'}}</span>
                </li>
                <li>
                    <strong>Mail LinkedIn envoyé ?</strong>
                    <span>{{ selectedClient?.prospection?.mailLinkedInEnvoye }}</span>
                </li>
                <li *ngIf="selectedClient?.prospection?.mailLinkedInEnvoye == true">
                    <strong>Date d'envoi mail LinkedIn</strong>
                    <span>{{ selectedClient?.prospection?.dateEnvoiMailLinkedIn | date: 'dd/MM/yyyy HH:mm' }}</span>
                </li>

            </ul>
        </div>
    </div>
</p-dialog>






<p-dialog
    [(visible)]="isDialogVisible"
    [modal]="true"
    [resizable]="false"
    [draggable]="false"
    [header]="'Editer Client'"
    [style]="{ width: '90vw', height: '8000000000vh' }"
    [contentStyle]="{ height: '700vh', overflow: 'auto' }"
    [baseZIndex]="1100">
    <ng-container *ngIf="isDialogVisible">
        <app-societe-clients [id]="selectedClientId"></app-societe-clients>
    </ng-container>
</p-dialog>
